<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2c3e50">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Francisco Running - Calculateur de temps</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #ecf0f1; min-height:100vh; padding:20px;
}
.container { max-width:650px; margin:0 auto; background:white; border-radius:12px; padding:30px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
.header { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:30px; padding-bottom:20px; border-bottom:2px solid #ecf0f1; }
.header .runner-icon { font-size:32px; }
.header h1 { color:#2c3e50; font-size:24px; font-weight:600; }
.section { margin-bottom:30px; }
.section-title { color:#2c3e50; font-size:18px; font-weight:600; margin-bottom:15px; }
.input-row { display:flex; gap:10px; margin-bottom:15px; }
.input-group { flex:1; position:relative; }
label { display:block; margin-bottom:6px; color:#34495e; font-weight:500; font-size:14px; }
.helper-text { display:block; margin-bottom:6px; color:#7f8c8d; font-size:11px; font-style:italic; }
select, input[type="number"] {
  width:100%; padding:12px; border:1px solid #bdc3c7; border-radius:12px;
  font-size:16px; appearance:none; background:white;
  -webkit-appearance: none; -moz-appearance: none;
}

/* Style picker unique pour le temps */
.time-picker-single {
  position: relative;
  width: 100%;
  padding: 16px;
  border: 1px solid #bdc3c7;
  border-radius: 12px;
  background: white;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}
.time-picker-single:active {
  background: #f8f9fa;
}
.time-display {
  font-size: 24px;
  font-weight: 600;
  color: #2c3e50;
  letter-spacing: 1px;
}
.time-label {
  font-size: 12px;
  color: #7f8c8d;
  margin-top: 4px;
}

/* Modal picker */
.picker-backdrop {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.picker-backdrop.active {
  display: block;
  opacity: 1;
}
.picker-modal {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f7f7f7;
  z-index: 1001;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 14px 14px 0 0;
}
.picker-modal.active {
  transform: translateY(0);
}
.picker-toolbar {
  background: #f7f7f7;
  border-bottom: 1px solid #d1d1d6;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 16px;
  height: 44px;
}
.picker-button {
  color: #007aff;
  font-size: 17px;
  background: none;
  border: none;
  padding: 8px 16px;
  cursor: pointer;
  font-weight: 400;
}
.picker-button:active {
  opacity: 0.4;
}
.picker-title {
  font-size: 13px;
  color: #8e8e93;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.picker-content {
  height: 216px;
  position: relative;
  background: #f7f7f7;
  overflow: hidden;
  display: flex;
  gap: 8px;
  padding: 0 20px;
}
.picker-highlight {
  position: absolute;
  top: 50%;
  left: 20px;
  right: 20px;
  height: 36px;
  margin-top: -18px;
  background: rgba(0, 0, 0, 0.06);
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  pointer-events: none;
  z-index: 1;
}
.picker-column-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.picker-column-label {
  position: absolute;
  top: 50%;
  margin-top: 22px;
  font-size: 12px;
  color: #8e8e93;
  font-weight: 500;
  z-index: 2;
  pointer-events: none;
}
.picker-column {
  height: 100%;
  width: 100%;
  overflow-y: scroll;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: y mandatory;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.picker-column::-webkit-scrollbar {
  display: none;
}
.picker-item {
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  color: #000;
  scroll-snap-align: center;
  transition: opacity 0.2s;
}
.picker-spacer {
  height: 90px;
  pointer-events: none;
}

select:focus, input:focus { outline:none; border-color:#3498db; }
button {
  width:100%; padding:14px; background:#2c3e50; color:white; border:none; border-radius:12px;
  font-size:16px; font-weight:500; cursor:pointer; margin-top:10px; transition:0.2s;
}
button:hover { background:#34495e; }
button.secondary {
  background: #95a5a6;
  margin-top: 10px;
}
button.secondary:hover { background: #7f8c8d; }
.results { display:none; margin-top:30px; }
.results.show { display:block; }
.current-pace {
  background: #ecf0f1;
  color: #34495e;
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 20px;
  text-align: center;
  border: 1px solid #d5d8dc;
}
.current-pace-label { 
  font-size: 12px; 
  color: #7f8c8d;
  margin-bottom: 4px;
  font-weight: 500;
}
.current-pace-value { 
  font-size: 20px; 
  font-weight: 600;
  color: #2c3e50;
}
.current-pace-unit { 
  font-size: 12px; 
  color: #7f8c8d;
  margin-top: 2px;
  font-weight: 400;
}
.predictions { background:#f8f9fa; padding:20px; border-radius:8px; margin-bottom:20px; border:1px solid #e0e0e0; }
.predictions h3 { color:#2c3e50; font-size:16px; margin-bottom:15px; font-weight:600; }
.prediction-item { display:grid; grid-template-columns:120px 1fr 1fr; gap:15px; padding:12px 0; border-bottom:1px solid #e0e0e0; align-items:center; }
.prediction-item:last-child { border-bottom:none; }
.prediction-distance { color:#5a6c7d; font-weight:600; }
.prediction-time { color:#2c3e50; font-weight:600; font-size:16px; }
.prediction-pace { color:#7f8c8d; font-size:14px; }
.vo2max-box { background:linear-gradient(135deg,#2c3e50 0%,#34495e 100%); color:white; padding:25px; border-radius:8px; text-align:center; margin-top:20px; }
.vo2max-label { font-size:14px; opacity:0.9; margin-bottom:8px; }
.vo2max-value { font-size:48px; font-weight:700; }
.vo2max-unit { font-size:18px; opacity:0.9; margin-top:5px; }
.custom-distance { display:none; margin-top:10px; }
@media(max-width:768px){ .container{padding:20px;} .input-row{flex-direction:column;} .prediction-item{grid-template-columns:1fr; gap:5px;} .vo2max-value{font-size:36px;} }
@media(max-width:480px){ .header h1{font-size:20px;} .header .runner-icon{font-size:28px;} }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <span class="runner-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
    <h1>francisco.running</h1>
  </div>

  <div class="section">
    <h2 class="section-title">Calculateur de temps de course</h2>

    <div class="input-group">
      <label>Distance de course</label>
      <span class="helper-text">S√©lectionnez la distance parcourue</span>
      <select id="distance">
        <option value="1000">1 km</option>
        <option value="3000">3 km</option>
        <option value="5000" selected>5 km</option>
        <option value="10000">10 km</option>
        <option value="15000">15 km</option>
        <option value="21097.5">Semi-marathon</option>
        <option value="42195">Marathon</option>
        <option value="other">Autre</option>
      </select>
      <input type="number" id="customDistance" class="custom-distance" step="0.01" placeholder="Entrez votre distance (km)">
    </div>

    <div class="input-group" style="margin-top:20px;">
      <label>Temps r√©alis√©</label>
      <span class="helper-text">Entrez votre temps de course</span>
      <div class="time-picker-single" id="timePicker">
        <div class="time-display" id="timeDisplay">00:00:00</div>
        <div class="time-label">Appuyez pour modifier</div>
      </div>
    </div>

    <button onclick="calculate()">Calculer</button>
    <button class="secondary" onclick="clearResults()">Effacer les r√©sultats</button>
  </div>

  <div class="results" id="results">
    <div class="current-pace">
      <div class="current-pace-label">Allure moyenne</div>
      <div class="current-pace-value" id="currentPaceValue">--</div>
      <div class="current-pace-unit">min/km</div>
    </div>

    <div class="predictions">
      <h3>üéØ Estimations de temps par distances</h3>
      <div id="predictions"></div>
    </div>

    <div class="vo2max-box">
      <div class="vo2max-label">Estimation de VO2max</div>
      <div class="vo2max-value" id="vo2maxValue">--</div>
      <div class="vo2max-unit">ml/kg/min</div>
    </div>
  </div>
</div>

<!-- Picker backdrop -->
<div class="picker-backdrop" id="pickerBackdrop"></div>

<!-- Picker modal -->
<div class="picker-modal" id="pickerModal">
  <div class="picker-toolbar">
    <button class="picker-button" id="pickerCancel">Annuler</button>
    <div class="picker-title">Temps de course</div>
    <button class="picker-button" id="pickerDone" style="font-weight: 600;">OK</button>
  </div>
  <div class="picker-content">
    <div class="picker-highlight"></div>
    <div class="picker-column-container">
      <div class="picker-column" id="hoursColumn"></div>
      <div class="picker-column-label">h</div>
    </div>
    <div class="picker-column-container">
      <div class="picker-column" id="minutesColumn"></div>
      <div class="picker-column-label">min</div>
    </div>
    <div class="picker-column-container">
      <div class="picker-column" id="secondsColumn"></div>
      <div class="picker-column-label">sec</div>
    </div>
  </div>
</div>

<script>
// Variables globales
let selectedHours = 0;
let selectedMinutes = 0;
let selectedSeconds = 0;

// Distance "Autre"
const distanceSelect = document.getElementById('distance');
const customDistance = document.getElementById('customDistance');
distanceSelect.addEventListener('change',()=>{
  if(distanceSelect.value==='other'){ customDistance.style.display='block'; } else { customDistance.style.display='none'; }
});

// Initialisation du picker
function initPicker() {
  document.getElementById('timePicker').addEventListener('click', openPicker);
  document.getElementById('pickerBackdrop').addEventListener('click', closePicker);
  document.getElementById('pickerCancel').addEventListener('click', closePicker);
  document.getElementById('pickerDone').addEventListener('click', confirmPicker);
}

function openPicker() {
  const modal = document.getElementById('pickerModal');
  const backdrop = document.getElementById('pickerBackdrop');
  const hoursColumn = document.getElementById('hoursColumn');
  const minutesColumn = document.getElementById('minutesColumn');
  const secondsColumn = document.getElementById('secondsColumn');
  
  // Remplir les colonnes
  hoursColumn.innerHTML = '<div class="picker-spacer"></div>';
  for(let i = 0; i <= 10; i++) {
    hoursColumn.innerHTML += `<div class="picker-item" data-value="${i}">${i}</div>`;
  }
  hoursColumn.innerHTML += '<div class="picker-spacer"></div>';
  
  minutesColumn.innerHTML = '<div class="picker-spacer"></div>';
  for(let i = 0; i < 60; i++) {
    minutesColumn.innerHTML += `<div class="picker-item" data-value="${i}">${i}</div>`;
  }
  minutesColumn.innerHTML += '<div class="picker-spacer"></div>';
  
  secondsColumn.innerHTML = '<div class="picker-spacer"></div>';
  for(let i = 0; i < 60; i++) {
    secondsColumn.innerHTML += `<div class="picker-item" data-value="${i}">${i}</div>`;
  }
  secondsColumn.innerHTML += '<div class="picker-spacer"></div>';
  
  // Afficher
  backdrop.classList.add('active');
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  // Positionner sur les valeurs actuelles
  setTimeout(() => {
    scrollToValue(hoursColumn, selectedHours);
    scrollToValue(minutesColumn, selectedMinutes);
    scrollToValue(secondsColumn, selectedSeconds);
    
    setupPickerScroll(hoursColumn);
    setupPickerScroll(minutesColumn);
    setupPickerScroll(secondsColumn);
  }, 50);
}

function scrollToValue(column, value) {
  const items = column.querySelectorAll('.picker-item');
  const targetItem = Array.from(items).find(item => parseInt(item.dataset.value) === value);
  if (targetItem) {
    targetItem.scrollIntoView({ block: 'center' });
  }
}

function setupPickerScroll(column) {
  let scrollTimeout;
  
  const updateOpacity = () => {
    const items = column.querySelectorAll('.picker-item');
    const columnRect = column.getBoundingClientRect();
    const centerY = columnRect.top + columnRect.height / 2;
    
    items.forEach(item => {
      const itemRect = item.getBoundingClientRect();
      const itemCenterY = itemRect.top + itemRect.height / 2;
      const distance = Math.abs(centerY - itemCenterY);
      const maxDistance = 72;
      const opacity = Math.max(0.3, 1 - (distance / maxDistance) * 0.7);
      item.style.opacity = opacity;
    });
  };
  
  const snapToCenter = () => {
    const items = column.querySelectorAll('.picker-item');
    const columnRect = column.getBoundingClientRect();
    const centerY = columnRect.top + columnRect.height / 2;
    
    let closestItem = null;
    let closestDistance = Infinity;
    
    items.forEach(item => {
      const itemRect = item.getBoundingClientRect();
      const itemCenterY = itemRect.top + itemRect.height / 2;
      const distance = Math.abs(centerY - itemCenterY);
      
      if (distance < closestDistance) {
        closestDistance = distance;
        closestItem = item;
      }
    });
    
    if (closestItem) {
      closestItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  };
  
  column.addEventListener('scroll', () => {
    updateOpacity();
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      snapToCenter();
    }, 100);
  });
  
  updateOpacity();
}

function closePicker() {
  const modal = document.getElementById('pickerModal');
  const backdrop = document.getElementById('pickerBackdrop');
  
  modal.classList.remove('active');
  backdrop.classList.remove('active');
  document.body.style.overflow = '';
}

function getSelectedValue(column) {
  const items = column.querySelectorAll('.picker-item');
  const columnRect = column.getBoundingClientRect();
  const centerY = columnRect.top + columnRect.height / 2;
  
  let selectedItem = null;
  let closestDistance = Infinity;
  
  items.forEach(item => {
    const itemRect = item.getBoundingClientRect();
    const itemCenterY = itemRect.top + itemRect.height / 2;
    const distance = Math.abs(centerY - itemCenterY);
    
    if (distance < closestDistance) {
      closestDistance = distance;
      selectedItem = item;
    }
  });
  
  return selectedItem ? parseInt(selectedItem.dataset.value) : 0;
}

function confirmPicker() {
  const hoursColumn = document.getElementById('hoursColumn');
  const minutesColumn = document.getElementById('minutesColumn');
  const secondsColumn = document.getElementById('secondsColumn');
  
  selectedHours = getSelectedValue(hoursColumn);
  selectedMinutes = getSelectedValue(minutesColumn);
  selectedSeconds = getSelectedValue(secondsColumn);
  
  updateTimeDisplay();
  closePicker();
}

function updateTimeDisplay() {
  const h = selectedHours.toString().padStart(2, '0');
  const m = selectedMinutes.toString().padStart(2, '0');
  const s = selectedSeconds.toString().padStart(2, '0');
  document.getElementById('timeDisplay').textContent = `${h}:${m}:${s}`;
}

// Formules VO2max avec ajustement marathon √† 3.5%
function calculateVO2(v){ return -4.60 + 0.182258*v + 0.000104*v**2; }
function calculatePercentVO2Max(t){ return 0.8 + 0.1894393*Math.exp(-0.012778*t)+0.2989558*Math.exp(-0.1932605*t); }
function calculateVDOT(distance, tSec){
  const tMin = tSec/60;
  const v = distance / tMin;
  return calculateVO2(v)/calculatePercentVO2Max(tMin);
}
function predictTime(vdot, distance){
  let low=60, high=36000, bestTime=low;
  
  // Ajustement sp√©cifique pour le marathon (facteur de fatigue de 3.5%)
  let adjustedVdot = vdot;
  if(distance >= 42195) {
    adjustedVdot = vdot * 0.965;
  }
  
  for(let i=0;i<100;i++){
    const mid=(low+high)/2; 
    const test=calculateVDOT(distance, mid);
    if(Math.abs(test-adjustedVdot)<0.01){ bestTime=mid; break; }
    if(test>adjustedVdot){ low=mid; }else{ high=mid; } 
    bestTime=mid;
  }
  return bestTime;
}
function formatTime(s){ const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=Math.round(s%60); return h>0?`${h}h${m.toString().padStart(2,'0')}'${sec.toString().padStart(2,'0')}"`:`${m}'${sec.toString().padStart(2,'0')}"`; }
function formatPace(sPerKm){ const m=Math.floor(sPerKm/60), sec=Math.round(sPerKm%60); return `${m}:${sec.toString().padStart(2,'0')}`; }

function calculate(){
  let distance=parseFloat(distanceSelect.value);
  if(distanceSelect.value==='other'){
    distance=parseFloat(customDistance.value)*1000;
    if(isNaN(distance)||distance<=0){ alert('Entrez une distance valide'); return; }
  }

  const h = selectedHours;
  const m = selectedMinutes;
  const s = selectedSeconds;
  const totalSec = h*3600 + m*60 + s;
  
  if(totalSec===0){ alert('Entrez un temps valide'); return; }

  // Calcul de l'allure actuelle
  const currentPacePerKm = totalSec / (distance / 1000);
  document.getElementById('currentPaceValue').textContent = formatPace(currentPacePerKm);

  const vo2max=calculateVDOT(distance,totalSec);

  // Pr√©dictions
  const races=[{name:'1 km',distance:1000},{name:'3 km',distance:3000},
  {name:'5 km',distance:5000},{name:'10 km',distance:10000},{name:'15 km',distance:15000},
  {name:'Semi-marathon',distance:21097.5},{name:'Marathon',distance:42195}];

  let html='';
  races.forEach(r=>{
    const t=predictTime(vo2max,r.distance);
    const pace=t/(r.distance/1000);
    html+=`<div class="prediction-item"><div class="prediction-distance">${r.name}</div><div class="prediction-time">${formatTime(t)}</div><div class="prediction-pace">${formatPace(pace)}/km</div></div>`;
  });
  document.getElementById('predictions').innerHTML=html;
  document.getElementById('vo2maxValue').textContent=Math.round(vo2max);
  document.getElementById('results').classList.add('show');
  document.getElementById('results').scrollIntoView({behavior:'smooth', block:'nearest'});
}

function clearResults() {
  document.getElementById('results').classList.remove('show');
  selectedHours = 0;
  selectedMinutes = 0;
  selectedSeconds = 0;
  updateTimeDisplay();
  distanceSelect.value = '5000';
  customDistance.style.display = 'none';
  customDistance.value = '';
}

// Initialisation
initPicker();
</script>
</body>
</html>
